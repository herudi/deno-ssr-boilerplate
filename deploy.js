var Ot=Object.create;var k=Object.defineProperty;var At=Object.getOwnPropertyDescriptor;var Ft=Object.getOwnPropertyNames;var Wt=Object.getPrototypeOf,Nt=Object.prototype.hasOwnProperty;var Lt=t=>k(t,"__esModule",{value:!0});var J=(t,e)=>()=>(t&&(e=t(t=0)),e);var Gt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),pt=(t,e)=>{for(var s in e)k(t,s,{get:e[s],enumerable:!0})},It=(t,e,s,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ft(e))!Nt.call(t,n)&&(s||n!=="default")&&k(t,n,{get:()=>e[n],enumerable:!(o=At(e,n))||o.enumerable});return t},Ct=(t,e)=>It(Lt(k(t!=null?Ot(Wt(t)):{},"default",!e&&t&&t.__esModule?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);import{join as C,resolve as vt,toFileUrl as H}from"https://deno.land/std@0.126.0/path/mod.ts";import{walk as st}from"https://deno.land/std@0.126.0/fs/walk.ts";var Et=J(()=>{});var Pt={};pt(Pt,{STORAGE_KEY_API:()=>rt,STORAGE_KEY_PAGE:()=>at,genPages:()=>$t,genRoutesWithRefresh:()=>he,getListPages:()=>ye});async function ye(){let t=Deno.cwd(),e=[],s=C(t,"./src/pages"),o=H(s),n=st(s,{includeDirs:!1,includeFiles:!0,exts:["tsx","jsx","ts","js"]});for await(let a of n)if(a.isFile){let i=H(a.path).href.substring(o.href.length);i.startsWith("/_app.")||i.startsWith("/api/")||e.push("./src/pages"+i)}return e}async function jt(t,e,s){let o=e+"/src/pages",n=!1,a=!1;for(let i=0;i<t.length;i++){let p=t[i],c=(await Deno.stat(C(o,p))).mtime?.getTime();s[p]||(s[p]=c,a||(a=!0)),s[p]!==c&&(s[p]=c,n||(n=!0))}return{storage:s,status:n,new_entry:a}}function ot(t){let e=t.substring(0,t.lastIndexOf("."));return e.endsWith("/index")&&(e=e.substring(0,e.lastIndexOf("/index"))),e===""&&(e="/"),e="/"+e.split("/").reduce((s,o)=>o.startsWith("[...")&&o.endsWith("]")?s+"/:"+o.slice(4,o.length-1)+"*":o.startsWith("[")&&o.endsWith("]")?s+"/:"+o.slice(1,o.length-1):!s.startsWith("api")&&s!==""?s+"/"+o:o,""),e}function nt(t,e,s){return e==="page"&&s==="development"?`
${t.map((o,n)=>`import $${n} from "../../src/pages${o}";`).join(`
`)}
export const map_pages: any = [
  ${t.map((o,n)=>`{ 
    path: '${ot(o)}',
    page: $${n},
    methods: ($${n} as any).methods
  },`).join(`
  `)}
];
export const tt: string = '${Date.now()}';
`:e==="page"&&s==="production"?`
export const map_pages = [
  ${t.map(o=>{let n=ot(o),a=o.replace(".tsx",".js").replace(".jsx",".js");return`{ 
    path: '${n}',
    page: '.${a}'
  },`}).join(`
  `)}
];
export const tt: string = '${Date.now()}';
`:`
import { Router, Handler } from "https://deno.land/x/nhttp@1.1.10/mod.ts";
import { RequestEvent } from "./../deps/types.ts";
${t.map((o,n)=>`import $${n} from "../../src/pages${o}";`).join(`
`)}
const api = new Router<RequestEvent>();
const map = {} as Record<string, Handler<RequestEvent> | Handler<RequestEvent>[]>;
  ${t.map((o,n)=>{let a=ot(o);return`
map['${o}'] = $${n};
api.any('${a}', $${n});`}).join(`
  `)}
export default { api, map };
`}async function $t(t=!1,e="development",s=Deno.cwd()){try{s=vt(s);let o=JSON.parse(localStorage.getItem(at)||"{}"),n=JSON.parse(localStorage.getItem(rt)||"{}"),a=[],i=[],p=C(s,"./src/pages"),x=H(p),c=st(p,{includeDirs:!1,includeFiles:!0,exts:["tsx","jsx","ts","js"]});for await(let _ of c)if(_.isFile){let b=H(_.path).href.substring(x.href.length);b.startsWith("/_app.")||(b.startsWith("/api/")?i.push(b):a.push(b))}let R=await jt(a,s,o),j=await jt(i,s,n);if((R.new_entry||R.status||t)&&localStorage.setItem(at,JSON.stringify(R.storage)),(j.new_entry||j.status||t)&&localStorage.setItem(rt,JSON.stringify(j.storage)),R.status||t){let _=nt(a,"page",e),b=s+"/_core/result/pages.ts";if(await Deno.writeTextFile(b,_),e==="production"){let Tt=nt(a,"page","development"),Dt=s+"/_core/result/server_pages.ts";await Deno.writeTextFile(Dt,Tt)}}if(j.status||t){let _=nt(i,"api",e),b=s+"/_core/result/apis.ts";await Deno.writeTextFile(b,_)}}catch(o){return console.log(o),o}}async function he(t){return localStorage.clear(),await $t(!0,t)}var at,rt,Rt=J(()=>{Et();at="95d6aa06f620",rt="01a2929d18cf"});var _t={};pt(_t,{map_pages:()=>be,tt:()=>we});var be,we,qt=J(()=>{be=[{path:"/blog",page:"./blog/index.js"},{path:"/blog/:title",page:"./blog/[title].js"},{path:"/",page:"./index.js"},{path:"/sign",page:"./sign.js"}],we="1646661258114"});var St=Gt((Rs,ve)=>{ve.exports={imports:{"nano-jsx":"https://deno.land/x/nano_jsx@v0.0.30/mod.ts",twind:"https://cdn.skypack.dev/twind@0.16.16",nhttp:"https://deno.land/x/nhttp@1.1.10/mod.ts",types:"./_core/deps/types.ts"}}});import{h as it}from"https://deno.land/x/nano_jsx@v0.0.30/mod.ts";import{Helmet as Bt,renderSSR as Ut}from"https://deno.land/x/nano_jsx@v0.0.30/mod.ts";import{setup as Jt}from"https://cdn.skypack.dev/twind@0.16.16";import{getStyleTag as zt,virtualSheet as Mt}from"https://cdn.skypack.dev/twind@0.16.16/sheets";import Vt from"https://cdn.skypack.dev/@twind/typography@0.0.2";var lt=null;function mt(t={}){return lt??(lt=Yt(t))}function Yt(t){let e=Mt();return Jt({...t,sheet:e,plugins:{...Vt()}}),e}var Kt=({body:t,attributes:e,head:s,footer:o,styleTag:n,clientScript:a,env:i,initData:p,tt:x})=>`<!DOCTYPE html>
<html ${e.html.toString()}>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    ${s.join(`
    `)}
    ${n}
  </head>
  ${e.body.size===0?"<body>":`<body ${e.body.toString()}>`}
    <div id="root">${t}</div>
    ${p!==void 0?`<script id="__INIT_DATA__" type="application/json">${JSON.stringify(p)}<\/script>`:""}${o.join(`
    `)}${i==="development"?'<script src="/assets/js/refresh_client.js"><\/script>':""}${a?`<script type="module" src="${a+"?v="+x}"><\/script>`:""}
  </body>
<html>
`;function T(t,e={}){mt(e.tw??{}).reset();let s=Ut(t,e),{body:o,head:n,footer:a,attributes:i}=Bt.SSR(s),p=zt(mt());return new Response(Kt({...e,body:o,head:n,footer:a,styleTag:p,attributes:i}),{headers:{"content-type":"text/html"},status:e.status||200})}import{HttpError as Ee,NHttp as je}from"https://deno.land/x/nhttp@1.1.10/mod.ts";import $e from"https://deno.land/x/static_files@1.1.6/mod.ts";import{h as Zt}from"https://deno.land/x/nano_jsx@v0.0.30/mod.ts";import{h as w,Helmet as Xt}from"https://deno.land/x/nano_jsx@v0.0.30/mod.ts";import{h as g,Router as Qt}from"https://deno.land/x/nano_jsx@v0.0.30/mod.ts";import{tw as y}from"https://cdn.skypack.dev/twind@0.16.16";var{Link:z}=Qt,M="bg-gray-900 text-white px-3 py-2 rounded-md text-sm font-medium",D="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium";function V({route:t}){return g("nav",{class:y`bg-gray-800 sticky top-0 z-10`},g("div",{class:y`max-w-7xl mx-auto px-2 sm:px-6 lg:px-8`},g("div",{class:y`relative flex items-center justify-between h-16`},g("div",{class:y`flex-1 flex items-center justify-center sm:items-stretch sm:justify-start`},g("div",{class:y`sm:block sm:ml-6`},g("div",{class:y`flex space-x-4`},g(z,{class:y`${t.pathname==="/"?M:D}`,to:"/"},"Home"),g(z,{class:y`${t.pathname.startsWith("/blog")?M:D}`,to:"/blog"},"Blog"),g(z,{class:y`${t.pathname==="/sign"?M:D}`,to:"/sign"},"Sign Form")))),g("div",{class:"absolute inset-y-0 right-0 flex items-center pr-2 sm:static sm:inset-auto sm:ml-6 sm:pr-0"},g("a",{class:y`${D}`,href:"https://github.com/herudi/deno-ssr-boilerplate",target:"__blank"},"Github")))))}function ct({Component:t,props:e}){return w("div",null,w(Xt,{head:!0},w("html",{lang:"en"}),w("link",{rel:"icon",href:"data:,"}),w("script",{src:"https://cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"}),w("link",{href:"https://cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css",rel:"stylesheet"})),e.route.pathname!=="/sign"&&w(V,{route:e.route}),w(t,{...e}))}var Y;ct.event={onStart(t){t.NProgress=window.NProgress,t.isFirst||(Y=setTimeout(()=>{t.NProgress.start()},300))},onEnd({NProgress:t}){Y&&clearTimeout(Y),t.done()},onError(t){console.error(t)}};var O=ct;function K({Page:t,initData:e,route:s,isServer:o}){return Zt(O,{Component:t,props:{...e,route:s,isServer:o}})}K.initProps=O.initProps;K.event=O.event||{};var A=K;import{Component as te,h as l,Helmet as ee,Router as se}from"https://deno.land/x/nano_jsx@v0.0.30/mod.ts";import{tw as d}from"https://cdn.skypack.dev/twind@0.16.16";var{Link:dt}=se,ut=class extends te{static async initProps(e){let s;return e.isServer?s=await e.handler("/api/blog/index.ts"):s=await(await fetch(e.getBaseUrl()+"/api/blog")).json(),{data:s}}didMount(){window.scrollTo(0,0)}render(){return l("div",null,l(ee,null,l("title",null,"Hello Blog Page")),l("div",{class:d`bg-white min-h-screen`},l("main",{class:d`max-w-5xl mx-auto px-4 pb-28 sm:px-6 md:px-8 xl:px-12 xl:max-w-6xl`},l("header",{class:d`pt-10 pb-9 sm:pb-16 sm:text-center`},l("h1",{class:d`mb-4 text-3xl sm:text-4xl tracking-tight font-extrabold`},"Blog"),l("p",{class:d`text-lg`},"Example blog page with dummy data")),l("div",{class:d`space-y-16`},this.props.data.map(e=>l("article",{class:d`relative flex flex-col max-w-3xl lg:ml-auto xl:max-w-none xl:w-[50rem]`},l("h3",{class:d`mb-4 text-xl tracking-tight font-bold`},l(dt,{to:"/blog/"+e.title},e.title)),l("div",{class:d`mb-6`},l("p",null,e.body)),l("div",{class:d`mt-auto flex flex-row-reverse items-center justify-end`},l("div",{class:d`text-sm leading-6 lg:absolute lg:top-0 lg:right-full lg:mr-8 lg:whitespace-nowrap`},"January, 12 2030"),l(dt,{to:"/blog/"+e.title,class:d`px-6 py-2 text-sm font-semibold text-blue-800 bg-blue-100`},"Read More"))))))))}},Q=ut;import{Component as oe,h,Helmet as ne,Router as ae}from"https://deno.land/x/nano_jsx@v0.0.30/mod.ts";import{tw as q}from"https://cdn.skypack.dev/twind@0.16.16";var{Link:re}=ae,gt=class extends oe{static async initProps(e){let s;return e.isServer?s=await e.handler("/api/blog/[title].ts"):(s=await fetch(e.getBaseUrl()+"/api/blog/"+e.params.title),s=await s.json()),{data:s[0]||{}}}didMount(){window.scrollTo(0,0)}render(){let e=this.props.route;return h("div",null,h(ne,null,h("title",null,e.params.title)),h("div",{class:q`bg-white flex h-screen`},h("div",{class:q`max-w-5xl mx-auto px-4 pb-28 mt-10 sm:px-6 md:px-8 xl:px-12 xl:max-w-6xl`},h("div",null,h("div",{class:q`text-sm sm:text-center`},"January, 12 2030"),h("h1",{class:q`col-span-full text-3xl sm:text-4xl sm:text-center xl:mb-16 font-extrabold tracking-tight`},e.params.title),h("p",{class:q`mb-20`},this.props.data.body),h(re,{to:"/blog",class:q`px-6 py-2 text-sm font-semibold text-blue-800 bg-blue-100`},"Back")))))}},X=gt;import{Component as ie,h as u,Helmet as pe}from"https://deno.land/x/nano_jsx@v0.0.30/mod.ts";import{tw as v}from"https://cdn.skypack.dev/twind@0.16.16";var ft={button:"text-2xl px-6 py-2 text-sm font-semibold text-white bg-gray-800"},xt=class extends ie{constructor(){super(...arguments);this.value=0}changeValue(e){this.value+=e,this.update()}render(){return u("div",null,u(pe,null,u("title",null,"Hello Home Page")),u("div",{class:v`bg-white flex justify-center h-screen`},u("div",null,u("div",{class:v`text-center mt-20 mb-10 text-gray-600`},u("h3",{class:v`text-5xl`},"Welcome Home"),u("p",{class:v`text-2xl`},"Example Counter App")),u("div",{class:v`text-center`},u("button",{class:v`${ft.button}`,onClick:()=>this.changeValue(1)},"+"),u("span",{class:v`p-5 text-2xl text-sm font-bold text-blue-800`},this.value),u("button",{class:v`${ft.button}`,onClick:()=>this.changeValue(-1)},"-")))))}},Z=xt;import{Component as le,h as r,Helmet as me}from"https://deno.land/x/nano_jsx@v0.0.30/mod.ts";import{tw as m}from"https://cdn.skypack.dev/twind@0.16.16";var yt={input:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"},tt=class extends le{static async initProps(e){if(e.isServer&&e.request.method==="POST"){let{message:s}=await e.handler("/api/sign.ts");return s==="success"?e.response.redirect("/"):{message:s}}return{}}render(){return r("div",null,r(me,null,r("title",null,"Sign Page")),r("div",{class:m`min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8`},r("div",{class:m`max-w-sm w-full space-y-8`},r("div",null,r("h2",{class:m`mt-6 text-center text-3xl font-extrabold text-gray-900`},"Sign Page"),r("p",{class:m`text-center`},"(Example handle form with POST)"),this.props.message&&r("div",{class:m`mt-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative`,role:"alert"},r("strong",{class:m`font-bold`},"Error"),r("span",{class:m`block sm:inline`},this.props.message),r("span",{class:m`absolute top-0 bottom-0 right-0 px-4 py-3`},r("svg",{class:m`fill-current h-6 w-6 text-red-500`,role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},r("title",null,"Close"),r("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})))),r("form",{class:m`mt-8 space-y-6`,action:"/sign",method:"POST"},r("div",{class:m`rounded-md shadow-sm -space-y-px`},r("div",null,r("label",{class:m`sr-only`},"Username"),r("input",{name:"username",type:"text",class:m`${yt.input}`,placeholder:"Username = deno",requied:!0})),r("div",null,r("label",{class:m`sr-only`},"Password"),r("input",{name:"password",type:"password",class:m`${yt.input}`,placeholder:"Password = deno",requied:!0}))),r("div",null,r("button",{type:"submit",class:m`group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500`},"Sign in")))))))}};tt.methods=["GET","POST"];var et=tt;var ht=[{path:"/blog",page:Q,methods:Q.methods},{path:"/blog/:title",page:X,methods:X.methods},{path:"/",page:Z,methods:Z.methods},{path:"/sign",page:et,methods:et.methods}];import{Router as ge}from"https://deno.land/x/nhttp@1.1.10/mod.ts";import{HttpError as ce}from"https://deno.land/x/nhttp@1.1.10/mod.ts";async function F(t){if(t.request.method=="GET")return await(await fetch("https://jsonplaceholder.typicode.com/posts?_limit=10")).json();throw new ce(405,"method not allowed")}import{HttpError as de}from"https://deno.land/x/nhttp@1.1.10/mod.ts";async function W(t){if(t.request.method=="GET")return await(await fetch(`https://jsonplaceholder.typicode.com/posts?title=${t.params.title}`)).json();throw new de(405,"method not allowed")}import{HttpError as ue}from"https://deno.land/x/nhttp@1.1.10/mod.ts";async function N(t){if(t.request.method=="GET")return{};if(t.request.method=="POST"){let{username:e,password:s}=t.body;return e==="deno"&&s==="deno"?{message:"success"}:{message:"wrong username and password"}}throw new ue(405,"method not allowed")}var L=new ge,G={};G["/api/blog/index.ts"]=F;L.any("/blog",F);G["/api/blog/[title].ts"]=W;L.any("/blog/:title",W);G["/api/sign.ts"]=N;L.any("/sign",N);var I={api:L,map:G};import{h as E}from"https://deno.land/x/nano_jsx@v0.0.30/mod.ts";import{tw as $}from"https://cdn.skypack.dev/twind@0.16.16";function fe({message:t}){return E("div",{class:$`flex items-center justify-center w-screen h-screen`},E("div",{class:$`px-40 py-20 bg-white rounded-md`},E("div",{class:$`flex flex-col items-center`},E("h1",{class:$`font-bold text-blue-600 text-9xl`},"404"),E("h6",{class:$`mb-2 text-2xl font-bold text-center text-gray-800 md:text-3xl`},E("span",{class:"text-red-500"},"Oops!")," Page not found"),E("p",{class:$`mb-8 text-center text-gray-500 md:text-lg`},t||"not found"),E("a",{href:"/",class:$`px-6 py-2 text-sm font-semibold text-blue-800 bg-blue-100`},"Go home"))))}var bt=fe;import{h as P}from"https://deno.land/x/nano_jsx@v0.0.30/mod.ts";import{tw as S}from"https://cdn.skypack.dev/twind@0.16.16";function xe({message:t,status:e}){return P("div",{class:S`flex items-center justify-center w-screen h-screen`},P("div",{class:S`px-40 py-20 bg-white rounded-md`},P("div",{class:S`flex flex-col items-center`},P("h1",{class:S`font-bold text-blue-600 text-9xl`},e||500),P("h6",{class:S`mb-2 text-2xl font-bold text-center text-gray-800 md:text-3xl`},P("span",{class:"text-red-500"},"Oops!")," Error"),P("p",{class:S`mb-8 text-center text-gray-500 md:text-lg`},t||"something went wrong"))))}var wt=xe;var B=(Deno.args||[]).includes("--dev")?"development":"production",Ht="/assets/pages/_app.js",Pe=Date.now(),U=[],f=new je({env:B});if(B==="development"){try{await Deno.remove(Deno.cwd()+"/public/pages",{recursive:!0})}catch{}let{genPages:t}=await Promise.resolve().then(()=>(Rt(),Pt)),{map_pages:e}=await Promise.resolve().then(()=>(qt(),_t)),{refresh:s}=await import("https://deno.land/x/refresh@1.0.0/mod.ts"),o=await import("https://deno.land/x/esbuild@v0.14.22/mod.js"),n=await import("https://esm.sh/esbuild-plugin-import-map?no-check"),a=(await Promise.resolve().then(()=>Ct(St()))).default;a.imports["nano-jsx"]="https://cdn.skypack.dev/nano-jsx@v0.0.30",U=e,await t(),n.load(a);let p=(await o.build({jsxFactory:"h",jsxFragment:"Fragment",format:"esm",loader:{".ts":"ts",".js":"js",".tsx":"tsx"},write:!1,bundle:!0,plugins:[n.plugin()],entryPoints:["./_core/tsx/hydrate.tsx"],outfile:"./public/pages/_app.js"})).outputFiles[0]?.text||"noop",x=s({paths:"./src/pages/"});f.use((c,R)=>{let j=x(c.request);return j||R()}),f.get(Ht,({response:c})=>(c.type("application/javascript"),p))}else U=ht;f.use("/assets",$e("public"));f.use((t,e)=>(t.getBaseUrl=()=>new URL(t.request.url).origin,t.isServer=!0,t.env=B,t.pathname=t.path,t.handler=async s=>{s.startsWith("/")||(s="/"+s);let o=I.map[s];if(Array.isArray(o)){let n=0,a=i=>{if(i)throw i instanceof Error?i:new Ee(500,String(i));return o[n++](t,a)};return await a()}return await I.map[s](t,e)},t.render=async(s,o)=>{let n=A.initProps?await A.initProps(t):{};if(n){let a=o.initData||{};o.initData={...a,...n}}return T(it(A,{isServer:!0,initData:o.initData,Page:s,route:{url:t.url,pathname:t.path,path:o.path,params:t.params}}),{clientScript:Ht,env:B,initData:o.initData,tt:Pe})},e()));f.use("/api",I.api);f.on404(t=>t.path.startsWith("/api/")?{status:404,message:`route ${t.url} not found`}:T(it(bt,{message:`route ${t.url} not found`,status:404}),{status:404}));f.onError((t,e)=>{let s=e.response.status();return e.path.startsWith("/api/")?{status:s,message:t.message}:T(it(wt,{message:t.message,status:s}),{status:s})});var kt=t=>{let e={};t&&(t(f),e=f.route);for(let s=0;s<U.length;s++){let o=U[s],n=o.methods||["GET"];for(let a=0;a<n.length;a++){let i=n[a];e[i+o.path]||f.on(i,o.path,async p=>{let x=o.page,c=x.initProps?await x.initProps(p):void 0;return p.render(x,{path:o.path,initData:c})})}}return f};kt().listen(8080,()=>{console.log("> Running on http://localhost:8080")});
